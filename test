#!/bin/bash

build=build_test_S9peX6noUt0qQaFBcTWp # a safeguard to delete nothing that is important

# set directory
cd "$(dirname "$0")"

# Build
rm -rf "$build"
mkdir "$build"
cd "$build"
echo "cmake .."
cmake .. > /dev/null
echo "make -j"
make -j > /dev/null


# Run
echo "Running tests. Should print CORRECT after at most x seconds:"


echo -n "    Test Communication          ( 1 sec): "
mpirun -n 10 ./test_comm;

echo -n "    Test State Comm             ( 1 sec): "
mpirun -n 10 ./test_state_comm;

echo -n "    Test Async Serialization    ( 1 sec): "
mpirun -n 2 ./test_async_serialization;

echo -n "    Test Rma Serialization      ( 1 sec): "
mpirun -n 2 ./test_rma_serialization;

echo -n "    Test Layer Simulation       ( 1 sec): "
./test_layer;


echo "COMPLETE"
cd ..
rm -rf "$build"
